name: Demo Environment

on:
  workflow_dispatch:  # Allow manual trigger

permissions:
  contents: read

jobs:
  demo:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v6

    - name: Start demo environment
      run: |
        cd demo
        docker compose up -d --wait --wait-timeout 120
        echo "Demo environment started successfully"

    - name: Run demo and display logs (5 minutes)
      run: |
        cd demo
        echo "========================================="
        echo "Starting 5-minute demo run with live logs"
        echo "========================================="
        
        # Run docker compose logs in background to follow all services
        docker compose logs -f &
        LOGS_PID=$!
        
        # Wait for 5 minutes
        sleep 300
        
        # Stop following logs
        kill $LOGS_PID 2>/dev/null || true
        
        echo "========================================="
        echo "Demo run complete"
        echo "========================================="

    - name: Stop demo environment
      if: always()
      run: |
        cd demo
        docker compose down -v
        echo "Demo environment stopped"
